<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: classes/RangeSelectorView.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: classes/RangeSelectorView.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import Decimal from 'decimal.js';

const RULER_NUMBER_OF_STEP = 10;

export default class RangeSelectorView {

  /**
   * 
   * @param {HTMLElement} elm
   * @param {Object} delegate
   * @param {Number} max
   * @param {String} orientation 'horizontal' or 'vertical'
   * @param {String} searchType 'simple' or 'advanced'
   */
  constructor(elm, delegate, max, orientation, searchType) {

    this.elm = elm;
    this._delegate = delegate;
    this._orientation = orientation;
    this._searchType = searchType;
    const ruler = (() => {
      let html = '';
      const step = new Decimal(max / RULER_NUMBER_OF_STEP);
      for (let i = 0; i &lt;= RULER_NUMBER_OF_STEP; i++) {
        html += `&lt;div class="scale">${step.times(new Decimal(i)).toNumber()}&lt;/div>`;
      }
      return html;
    })();
    elm.innerHTML = `
      &lt;div class="input">
        &lt;input class="from" max="1" min="0" step="0.01" type="number" value="0" title="Lower limit">
        ~
        &lt;input class="to" max="1" min="0" step="0.01" type="number" value="1" title="Upper limit">
        &lt;label>
          &lt;input class="invert" type="checkbox">Invert range
        &lt;/label>
      &lt;/div>
      &lt;div class="meter">
        &lt;div class="barcontainer">
          &lt;div class="bar">&lt;/div>
        &lt;/div>
        &lt;div class="ruler">${ruler}&lt;/div>
        &lt;div class="slider">
          &lt;div class="from">&lt;/div>
          &lt;div class="to">&lt;/div>
        &lt;/div>
      &lt;/div>
      ${searchType === 'simple' ?
      `&lt;div class="match">
        &lt;label>
          &lt;input class="all" name="match" type="radio" value="all">
          for all datasets
        &lt;/label>
        &lt;label>
          &lt;input class="any" checked="checked" name="match" type="radio" value="any">
          for any dataset
        &lt;/label>
      &lt;/div>` : ''}`;
    elm.classList.add(`-${orientation}`);

    // references
    const input = elm.querySelector(':scope > .input');
    this._from = input.querySelector(':scope > input.from');
    this._to = input.querySelector(':scope > input.to');
    this._invert = input.querySelector(':scope > label > input.invert');
    const meter = elm.querySelector(':scope > .meter');
    this._bar = meter.querySelector(':scope > .barcontainer > .bar');
    this._slider = meter.querySelector(':scope > .slider');
    this._sliderFrom = this._slider.querySelector(':scope > .from');
    this._sliderTo = this._slider.querySelector(':scope > .to');
    const match = elm.querySelector(':scope > .match');
    if (match) {
      this._all = match.querySelector(':scope > label > .all');
      this._any = match.querySelector(':scope > label > .any');
    }

    window.requestAnimationFrame(() => {
      // this._sliderWidth = this._slider.offsetWidth - 16;
  
      // events
      this._from.addEventListener('change', e => {
        e.target.value = parseFloat(e.target.value) &lt; 0 ? 0 : e.target.value;
        this._changeParameter({from: e.target.value + ''});
      });
      this._to.addEventListener('change', e => {
        e.target.value = parseFloat(e.target.value) > 1 ? 1 : e.target.value;
        this._changeParameter({to: e.target.value + ''});
      });
      this._invert.addEventListener('change', e => {
        this._changeParameter({invert: e.target.checked ? '1' : '0'});
      });
      if (match) {
        this._all.addEventListener('change', e => {
          this._changeParameter({match: e.target.checked ? 'all' : 'any'});
        });
        this._any.addEventListener('change', e => {
          this._changeParameter({match: e.target.checked ? 'any' : 'all'});
        });
      }
      $('.slider > *', meter).draggable({
        axis: 'x',
        containment: this._slider,
        stop: this._dragEnd.bind(this)
      });
      
      // default values
      // this._changeParameter({});
    });

  }

  _dragEnd(e, ui) {
    Decimal.precision = 3;
    switch (true) {
      case e.target.classList.contains('from'):
        this._changeParameter({from: Decimal.div(ui.position.left, this._sliderWidth).toNumber()});
        break;
      case e.target.classList.contains('to'):
        this._changeParameter({to: Decimal.div(ui.position.left - 8, this._sliderWidth).toNumber()});
        break;
    }
  }

  _changeParameter(newCondition) {
    // ensure sliders are not interchanged
    switch (true) {
      case newCondition.from !== undefined:
        if (this._to.value &lt;= newCondition.from) {
          newCondition.from = (parseFloat(this._to.value) - 0.001) + '';
        }
        break;
      case newCondition.to !== undefined:
        if (newCondition.to &lt;= this._from.value) {
          newCondition.to = (parseFloat(this._from.value) + 0.001) + '';
        }
        break;
    }

    // feedback
    this._delegate.changeParameter(newCondition, this.elm.dataset ? this.elm.dataset.dataset : '');
  }

  updateGUIWithCondition(condition) {
    window.requestAnimationFrame(() => {
      // values
      if (condition.from) this._from.value = condition.from;
      if (condition.to) this._to.value = condition.to;
      // slider
      this._sliderFrom.style.left = this._fromPosition;
      this._sliderTo.style.left = this._toPosition;
      // meter
      this._bar.style.left = `${this._from.value * 100}%`;
      this._bar.style.width = `${(this._to.value - this._from.value) * 100}%`;
      // invert
      if (condition.invert) this._invert.checked = condition.invert === '1' || condition.invert === true;
      if (this._invert.checked) {
        this.elm.classList.add('-inverting');
      } else {
        this.elm.classList.remove('-inverting');
      }
      // match
      if (this._searchType === 'simple') {
        this._all.checked = condition.match === 'all';
        this._any.checked = condition.match === 'any';
      }
    });
  }

  // get _sliderWidth() {
  //   return this._slider.offsetWidth - 16;
  // }
  get _fromPosition() {
    return `${this._sliderWidth * this._from.value}px`;
  }
  get _toPosition() {
    return `${this._sliderWidth * this._to.value + 8}px`;
  }

  get _sliderWidth() {
    return this._slider.offsetWidth - 16;
  }

}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="cachedAxios.html">cachedAxios</a></li><li><a href="module.exports_module.exports.html">exports</a></li></ul><h3>Global</h3><ul><li><a href="global.html#_addValueView">_addValueView</a></li><li><a href="global.html#_removeValueView">_removeValueView</a></li><li><a href="global.html#_update">_update</a></li><li><a href="global.html#addConditionViews">addConditionViews</a></li><li><a href="global.html#addNewConditionGroup">addNewConditionGroup</a></li><li><a href="global.html#addNewConditionItem">addNewConditionItem</a></li><li><a href="global.html#delete">delete</a></li><li><a href="global.html#elm">elm</a></li><li><a href="global.html#highlightedSuggestionIndex">highlightedSuggestionIndex</a></li><li><a href="global.html#isSelecting">isSelecting</a></li><li><a href="global.html#itemIdKey">itemIdKey</a></li><li><a href="global.html#itemLabelKey">itemLabelKey</a></li><li><a href="global.html#parentView">parentView</a></li><li><a href="global.html#removeConditionView">removeConditionView</a></li><li><a href="global.html#selectConditionView">selectConditionView</a></li><li><a href="global.html#selectedConditionViews">selectedConditionViews</a></li><li><a href="global.html#subTextKey">subTextKey</a></li><li><a href="global.html#suggestData">suggestData</a></li><li><a href="global.html#title">title</a></li><li><a href="global.html#type">type</a></li><li><a href="global.html#ungroup">ungroup</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Wed Sep 13 2023 10:36:47 GMT+0900 (Japan Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
